package assignmenti;

import javax.swing.*;
import javax.swing.border.EmptyBorder;
import java.awt.*;
import java.util.List;
import javax.swing.*;
import javax.swing.border.EmptyBorder;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.*;
import java.util.stream.Collectors;

public class InvoiceUI extends JFrame {
    private List<Invoice> invoiceList;
    private JTextArea resultTextArea;
    private JTextField partNumberField;
    private JTextField partDescriptionField;
    private JTextField quantityField;
    private JTextField pricePerItemField;

    public InvoiceUI(List<Invoice> invoiceList) {
        this.invoiceList = invoiceList;

        setTitle("Invoice Application");
        setSize(600, 400);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

        JPanel mainPanel = new JPanel();
        mainPanel.setLayout(new BorderLayout());

        resultTextArea = new JTextArea(10, 40);
        resultTextArea.setEditable(false);

        JScrollPane scrollPane = new JScrollPane(resultTextArea);

        JPanel buttonPanel = new JPanel();
        buttonPanel.setLayout(new FlowLayout());

        JButton partAButton = new JButton("Part A: Sort by partDescription");
        JButton partBButton = new JButton("Part B: Sort by pricePerItem");
        JButton partCButton = new JButton("Part C: Map and Sort by Quantity");
        JButton partDButton = new JButton("Part D: Map and Sort by Value");
        JButton partEButton = new JButton("Part E: Select Invoices $200-$500");
        JButton partFButton = new JButton("Part F: Find Invoice with 'Saw'");
        JButton addButton = new JButton("Add Invoice");
        JButton updateButton = new JButton("Update Invoice");
        JButton deleteButton = new JButton("Delete Invoice");

        partAButton.addActionListener(e -> displayPartAResults());
        partBButton.addActionListener(e -> displayPartBResults());
        partCButton.addActionListener(e -> displayPartCResults());
        partDButton.addActionListener(e -> displayPartDResults());
        partEButton.addActionListener(e -> displayPartEResults());
        partFButton.addActionListener(e -> displayPartFResults());
        addButton.addActionListener(e -> showAddDialog());
        updateButton.addActionListener(e -> showUpdateDialog());
        deleteButton.addActionListener(e -> showDeleteDialog());

        buttonPanel.add(partAButton);
        buttonPanel.add(partBButton);
        buttonPanel.add(partCButton);
        buttonPanel.add(partDButton);
        buttonPanel.add(partEButton);
        buttonPanel.add(partFButton);
        buttonPanel.add(addButton);
        buttonPanel.add(updateButton);
        buttonPanel.add(deleteButton);

        mainPanel.add(scrollPane, BorderLayout.CENTER);
        mainPanel.add(buttonPanel, BorderLayout.SOUTH);

        add(mainPanel);

        setVisible(true);
    }

    private void displayPartAResults() {
        List<Invoice> sortedList = invoiceList.stream()
                .sorted(Comparator.comparing(Invoice::getPartDescription))
                .collect(Collectors.toList());

        displayResults("Part A: Sorted by partDescription", sortedList);
    }

    private void displayPartBResults() {
        List<Invoice> sortedList = invoiceList.stream()
                .sorted(Comparator.comparingDouble(Invoice::getPricePerItem))
                .collect(Collectors.toList());

        displayResults("Part B: Sorted by pricePerItem", sortedList);
    }

    private void displayPartCResults() {
        List<Map.Entry<String, Integer>> resultList = invoiceList.stream()
                .map(invoice -> new AbstractMap.SimpleEntry<>(invoice.getPartDescription(), invoice.getQuantity()))
                .sorted(Comparator.comparingInt(Map.Entry::getValue))
                .collect(Collectors.toList());

        displayResults("Part C: Mapped to partDescription and sorted by quantity", resultList);
    }

    private void displayPartDResults() {
        List<Map.Entry<String, Double>> resultList = invoiceList.stream()
                .map(invoice -> new AbstractMap.SimpleEntry<>(invoice.getPartDescription(), invoice.getPaymentAmount()))
                .sorted(Comparator.comparingDouble(Map.Entry::getValue))
                .collect(Collectors.toList());

        displayResults("Part D: Mapped to partDescription and sorted by value", resultList);
    }

    private void displayPartEResults() {
        List<Invoice> resultList = invoiceList.stream()
                .filter(invoice -> invoice.getPaymentAmount() >= 200 && invoice.getPaymentAmount() <= 500)
                .sorted(Comparator.comparingDouble(Invoice::getPaymentAmount))
                .collect(Collectors.toList());

        displayResults("Part E: Invoices within the range $200 to $500", resultList);
    }

    private void displayPartFResults() {
        Optional<Invoice> result = invoiceList.stream()
                .filter(invoice -> invoice.getPartDescription().toLowerCase().contains("saw"))
                .findAny();

        if (result.isPresent()) {
            displayResults("Part F: An Invoice with 'Saw' in partDescription", Collections.singletonList(result.get()));
        } else {
            displayResults("Part F: No Invoice found with 'Saw' in partDescription", Collections.emptyList());
        }
    }

    private void displayResults(String title, List<?> results) {
        resultTextArea.setText(title + "\n\n");
        for (Object item : results) {
            resultTextArea.append(item.toString() + "\n");
        }
    }

    private void showAddDialog() {
        String partNumber = partNumberField.getText();
        String partDescription = partDescriptionField.getText();
        int quantity = Integer.parseInt(quantityField.getText());
        double pricePerItem = Double.parseDouble(pricePerItemField.getText());

        Invoice newInvoice = new Invoice(partNumber, partDescription, quantity, pricePerItem);
        invoiceList.add(newInvoice);

        displayResults("Invoice Added:", Collections.singletonList(newInvoice));

        // Clear input fields
        partNumberField.setText("");
        partDescriptionField.setText("");
        quantityField.setText("");
        pricePerItemField.setText("");
    }

    private void showUpdateDialog() {
        String partNumberToUpdate = JOptionPane.showInputDialog("Enter Part Number to Update:");
        Invoice invoiceToUpdate = null;

        for (Invoice invoice : invoiceList) {
            if (invoice.getPartNumber().equals(partNumberToUpdate)) {
                invoiceToUpdate = invoice;
                break;
            }
        }

        if (invoiceToUpdate != null) {
            String updatedPartDescription = JOptionPane.showInputDialog("Enter Updated Part Description:");
            int updatedQuantity = Integer.parseInt(JOptionPane.showInputDialog("Enter Updated Quantity:"));
            double updatedPricePerItem = Double.parseDouble(JOptionPane.showInputDialog("Enter Updated Price Per Item:"));

            invoiceToUpdate.updateInvoice(updatedPartDescription, updatedQuantity, updatedPricePerItem);
            displayResults("Invoice Updated:", Collections.singletonList(invoiceToUpdate));
        } else {
            JOptionPane.showMessageDialog(this, "Invoice not found for Part Number: " + partNumberToUpdate);
        }
    }

    private void showDeleteDialog() {
        String partNumberToDelete = JOptionPane.showInputDialog("Enter Part Number to Delete:");
        Invoice invoiceToDelete = null;

        for (Invoice invoice : invoiceList) {
            if (invoice.getPartNumber().equals(partNumberToDelete)) {
                invoiceToDelete = invoice;
                break;
            }
        }

        if (invoiceToDelete != null) {
            invoiceList.remove(invoiceToDelete);
           
            displayResults("Invoice Deleted:", Collections.singletonList(invoiceToDelete));
        } else {
            JOptionPane.showMessageDialog(this, "Invoice not found for Part Number: " + partNumberToDelete);
        }
    }

    public static void main(String[] args) {
        List<Invoice> invoiceList = new ArrayList<>();

        SwingUtilities.invokeLater(() -> {
            new InvoiceUI(invoiceList);
        });
    }
}
